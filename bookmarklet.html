<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEBULA - Instalar Bookmarklet</title>
    <style>
        :root { --bg: #0a0a0f; --surface: #12121a; --border: #1e1e2e; --text: #e2e8f0; --text-muted: #64748b; --accent: #6366f1; --green: #10b981; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', system-ui, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; padding: 40px 20px; }
        .container { max-width: 640px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 48px; }
        .logo { font-size: 28px; font-weight: 800; letter-spacing: 2px; color: var(--accent); }
        .logo span { font-weight: 400; font-size: 16px; color: var(--text-muted); letter-spacing: 0; margin-left: 8px; }
        h1 { font-size: 22px; margin-top: 16px; }
        .subtitle { color: var(--text-muted); margin-top: 8px; font-size: 14px; }
        .site-version {
            display: inline-block;
            margin-top: 10px;
            font-size: 11px;
            color: var(--accent);
            border: 1px solid rgba(99, 102, 241, 0.25);
            background: rgba(99, 102, 241, 0.12);
            border-radius: 999px;
            padding: 4px 9px;
            font-weight: 700;
        }

        .install-box { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 32px; text-align: center; margin-bottom: 32px; }
        .install-box p { color: var(--text-muted); font-size: 14px; margin-bottom: 20px; }

        .bookmarklet-link {
            display: inline-block; padding: 16px 32px; background: var(--accent); color: #fff;
            font-size: 16px; font-weight: 700; border-radius: 12px; text-decoration: none;
            cursor: grab; transition: all .2s; box-shadow: 0 4px 16px rgba(99,102,241,.3);
        }
        .bookmarklet-link:hover { transform: translateY(-2px); box-shadow: 0 6px 24px rgba(99,102,241,.4); }
        .bookmarklet-link:active { cursor: grabbing; }

        .drag-hint { display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 16px; color: var(--green); font-size: 13px; font-weight: 600; }

        .steps { margin-bottom: 32px; }
        .steps h2 { font-size: 16px; margin-bottom: 16px; color: var(--accent); }
        .step { display: flex; gap: 16px; align-items: flex-start; padding: 16px; background: var(--surface); border: 1px solid var(--border); border-radius: 12px; margin-bottom: 8px; }
        .step-num { flex-shrink: 0; width: 32px; height: 32px; background: var(--accent); color: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; }
        .step-text { font-size: 14px; line-height: 1.5; }
        .step-text strong { color: var(--accent); }

        .info { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 20px; font-size: 13px; color: var(--text-muted); line-height: 1.6; }
        .info strong { color: var(--text); }

        .back-link { display: block; text-align: center; margin-top: 32px; color: var(--accent); font-size: 14px; text-decoration: none; }
        .back-link:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">NEBULA <span>Bookmarklet</span></div>
            <h1>Salvar Vagas do LinkedIn</h1>
            <p class="subtitle">Adicione vagas do LinkedIn ao seu tracker com um clique</p>
            <span class="site-version">v2026.02.14-1341</span>
        </div>

        <div class="install-box">
            <p>Arraste o botao abaixo para a <strong>barra de favoritos</strong> do navegador:</p>
            <a class="bookmarklet-link" id="bookmarkletLink" href="javascript:(function() { 'use strict'; var SUPABASE_URL = 'https://hlpudkddsvhfngluqmkq.supabase.co'; var SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhscHVka2Rkc3ZoZm5nbHVxbWtxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEwMzMwNjYsImV4cCI6MjA4NjYwOTA2Nn0.dUQgXSDygDhUYsdzb-y1qpHXhzRBjF54vxoTt21E5Mo'; var API = SUPABASE_URL + '/rest/v1'; function showToast(msg, ok) { var el = document.getElementById('nebula-toast'); if (el) el.remove(); el = document.createElement('div'); el.id = 'nebula-toast'; el.textContent = msg; el.style.cssText = 'position:fixed;bottom:24px;right:24px;padding:16px 28px;border-radius:12px;font-size:15px;font-weight:700;z-index:99999;color:#fff;font-family:system-ui;box-shadow:0 4px 24px rgba(0,0,0,.3);transition:opacity .5s;' + (ok ? 'background:#10b981;' : 'background:#ef4444;'); document.body.appendChild(el); setTimeout(function() { el.style.opacity = '0'; }, 3000); setTimeout(function() { el.remove(); }, 3500); } function q(selectors) { for (var i = 0; i < selectors.length; i++) { var el = document.querySelector(selectors[i]); if (el && el.textContent.trim()) return el.textContent.trim(); } return ''; } function detectRemote(loc, desc) { var text = (loc + ' ' + desc).toLowerCase(); if (/\bremote\b/.test(text) && /\bhybrid\b/.test(text)) return 'hybrid'; if (/\bfully\s+remote\b/.test(text) || /\bremoto\b/.test(text)) return 'remote'; if (/\bremote\b/.test(text)) return 'remote'; if (/\bhybrid\b/.test(text) || /\bh.brido\b/.test(text)) return 'hybrid'; if (/\bon.?site\b/.test(text) || /\bpresencial\b/.test(text)) return 'onsite'; return 'unknown'; } function cleanUrl() { var m = window.location.href.match(/linkedin\.com\/jobs\/view\/(\d+)/); return m ? 'https://www.linkedin.com/jobs/view/' + m[1] + '/' : window.location.href.split('?')[0]; } if (!/linkedin\.com\/jobs/.test(window.location.href)) { showToast('Abra uma vaga do LinkedIn primeiro!', false); return; } // Strategy 1: Parse document.title (most reliable) // LinkedIn titles: &quot;Job Title - Company | LinkedIn&quot; or &quot;Company hiring Job Title in Location | LinkedIn&quot; var title = '', company = '', location = ''; var pageTitle = document.title.replace(/\s*\|\s*LinkedIn\s*$/, '').trim(); // Pattern: &quot;Company hiring: Job Title in Location&quot; var hiringMatch = pageTitle.match(/^(.+?)\s+(?:is\s+)?hiring:?\s+(.+?)(?:\s+in\s+(.+))?$/i); if (hiringMatch) { company = hiringMatch[1].trim(); title = hiringMatch[2].trim(); location = (hiringMatch[3] || '').trim(); } // Pattern: &quot;Job Title - Company - Location&quot; if (!title) { var dashParts = pageTitle.split(/\s*[-–—]\s*/); if (dashParts.length >= 2) { title = dashParts[0].trim(); company = dashParts[1].trim(); if (dashParts.length >= 3) location = dashParts[2].trim(); } } // Pattern: &quot;(number) Job Title - Company&quot; (when there's a notification count) if (!title || /^\(\d+\)/.test(title)) { var cleaned = pageTitle.replace(/^\(\d+\)\s*/, ''); var dp = cleaned.split(/\s*[-–—]\s*/); if (dp.length >= 2) { title = dp[0].trim(); company = dp[1].trim(); } } // Strategy 2: meta tags if (!title) { var ogTitle = document.querySelector('meta[property=&quot;og:title&quot;]'); if (ogTitle) { var og = ogTitle.content.replace(/\s*\|\s*LinkedIn\s*$/, '').trim(); var ogParts = og.split(/\s*[-–—]\s*/); if (ogParts.length >= 2) { title = ogParts[0].trim(); company = ogParts[1].trim(); } else title = og; } } // Strategy 3: DOM selectors as fallback if (!title) title = q([ 'h1.t-24', '.job-details-jobs-unified-top-card__job-title h1', '.job-details-jobs-unified-top-card__job-title', '.jobs-unified-top-card__job-title', '.top-card-layout__title', 'h1[class*=&quot;job&quot;]', 'h1[class*=&quot;title&quot;]', 'h1' ]); if (!company) company = q([ '.job-details-jobs-unified-top-card__company-name a', '.job-details-jobs-unified-top-card__company-name', '.jobs-unified-top-card__company-name a', '.jobs-unified-top-card__company-name', '.topcard__org-name-link', 'a[class*=&quot;company&quot;]', '.job-details-jobs-unified-top-card__primary-description-container a' ]); if (!location) location = q([ '.job-details-jobs-unified-top-card__bullet', '.jobs-unified-top-card__bullet', '.top-card-layout__bullet', 'span[class*=&quot;location&quot;]', 'span[class*=&quot;bullet&quot;]' ]); // Description var descEl = document.querySelector('#job-details') || document.querySelector('.jobs-description__content') || document.querySelector('.jobs-box__html-content') || document.querySelector('.description__text'); var description = descEl ? descEl.innerText.trim() : ''; // Fallback: manual prompt if (!title || !company) { var debug = 'Page title: ' + document.title; console.log('NEBULA DEBUG:', debug); var msg = prompt('Nao consegui extrair automaticamente.\n' + debug + '\n\nDigite: Titulo | Empresa'); if (msg) { var parts = msg.split('|').map(function(s){ return s.trim(); }); title = parts[0] || title; company = parts[1] || company; } if (!title || !company) { showToast('Titulo e empresa obrigatorios', false); return; } } var remote = detectRemote(location, description); var url = cleanUrl(); var payload = { title: title.substring(0, 500), company: company.substring(0, 300), location: location.substring(0, 300) || null, remote: remote, description: description || null, url: url, source: 'linkedin', status: 'ready', tier: 1, metadata: { added_via: 'bookmarklet', linkedin_url: url } }; showToast('Salvando vaga...', true); fetch(API + '/job_listings?select=id&title=eq.' + encodeURIComponent(payload.title) + '&company=eq.' + encodeURIComponent(payload.company) + '&deleted_at=is.null', { headers: { 'apikey': SUPABASE_KEY, 'Authorization': 'Bearer ' + SUPABASE_KEY } }) .then(function(r) { return r.json(); }) .then(function(existing) { if (existing && existing.length > 0) { showToast('Vaga ja existe no tracker!', false); return Promise.reject('duplicate'); } return fetch(API + '/job_listings', { method: 'POST', headers: { 'apikey': SUPABASE_KEY, 'Authorization': 'Bearer ' + SUPABASE_KEY, 'Content-Type': 'application/json', 'Prefer': 'return=representation' }, body: JSON.stringify(payload) }); }) .then(function(r) { if (!r) return; if (!r.ok) throw new Error('HTTP ' + r.status); return r.json(); }) .then(function(data) { if (!data) return; showToast('Vaga salva! ' + title + ' @ ' + company, true); }) .catch(function(e) { if (e === 'duplicate') return; showToast('Erro: ' + e.message, false); console.error('Nebula bookmarklet error:', e); }); })();">Salvar Vaga</a>
            <div class="drag-hint">Arraste para a barra de favoritos</div>
        </div>

        <div class="steps">
            <h2>Como usar</h2>
            <div class="step">
                <div class="step-num">1</div>
                <div class="step-text">Ative a <strong>barra de favoritos</strong> no navegador (Ctrl+Shift+B no Chrome)</div>
            </div>
            <div class="step">
                <div class="step-num">2</div>
                <div class="step-text"><strong>Arraste</strong> o botao roxo acima para a barra de favoritos</div>
            </div>
            <div class="step">
                <div class="step-num">3</div>
                <div class="step-text">Abra uma <strong>vaga no LinkedIn</strong> (linkedin.com/jobs/view/...)</div>
            </div>
            <div class="step">
                <div class="step-num">4</div>
                <div class="step-text">Clique em <strong>"Salvar Vaga"</strong> na barra de favoritos</div>
            </div>
            <div class="step">
                <div class="step-num">5</div>
                <div class="step-text">A vaga aparece no <strong>tracker</strong> como "Pronta" com tier 1</div>
            </div>
        </div>

        <div class="info">
            <strong>O que e extraido:</strong> titulo, empresa, localizacao, descricao completa, URL, e tipo (remote/hybrid/onsite).<br><br>
            <strong>Dedup:</strong> se a vaga ja existe no tracker (mesmo titulo + empresa), nao duplica.<br><br>
            <strong>Limitacao:</strong> funciona apenas no desktop. No celular, use o formulario manual no tracker.
        </div>

        <a class="back-link" href="jobs.html">Voltar para o Tracker</a>
    </div>
</body>
</html>
